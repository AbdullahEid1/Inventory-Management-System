@model IEnumerable<Inventory.Models.Product>

@{
    ViewData["Title"] = "Product";
}

<h2 class="mb-3">Products List</h2>

<!-- Notification Section -->
@if (Model.Any(product => product.StockQuantity < product.LowStockThreshold))
{
    <div class="alert alert-warning">
        <strong>Low Stock Alert!</strong> Some products are below their stock threshold. Please review the product list.
    </div>
}

<!-- Search Form -->
<form asp-action="Search" method="get" class="form-inline mb-3">
    <input type="text" name="keyword" class="form-control mr-2" placeholder="Search Products" />
    <button type="submit" class="btn btn-outline-danger mt-3">Search</button>
</form>

<!-- Filter by Category -->
<form method="get" asp-action="Index" class="form-inline mb-3">
    <div class="form-group">
        <label for="categoryFilter">Filter by Category: </label>
        <select id="categoryFilter" name="categoryId" class="form-control ml-2">
            <option value="">-- All Categories --</option>
            @foreach (var category in ViewBag.Categories)
            {
                <option value="@category.Value">@category.Text</option>
            }
        </select>
    </div>
    <button type="submit" class="btn btn-outline-danger ml-2 mt-3">Filter</button>
</form>

<div>
    <button class="btn btn-outline-success mb-3" onclick="window.print()">Print Products</button>
    <a class="btn btn-outline-success mb-3" asp-action="Create">
        <i class="fas fa-plus"></i> Create New Product
    </a>
</div>


<!-- Check if there are products -->
@if (!Model.Any())
{
    <div class="alert alert-dismissible alert-danger text-center">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        <h4 class="alert-heading">
            No Products Available   <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.964 0L.165 13.233c-.457.778.091 1.767.982 1.767h13.706c.89 0 1.439-.99.982-1.767L8.982 1.566zm-.982 4.905a.905.905 0 1 1 1.81 0l-.082 3.206a.823.823 0 0 1-1.646 0L8 6.471zm.002 5.48a1.13 1.13 0 1 1-2.262 0 1.13 1.13 0 0 1 2.262 0z" />
            </svg>
            

        </h4>
        <p class="mb-0">
             <a href="#" class="alert-link">
            </a>
        </p>
    </div>
}
else
{
    <table class="table table-striped table-hover table-bordered mt-3">
        <thead class="thead-dark">
            <tr>
                <th>Product Name</th>
                <th>Category</th>
                <th>Supplier</th>
                <th>Price (EGP)</th>
                <th>Stock Quantity</th>
                <th>Availability</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model)
            {
                // Check if the product is below its low stock threshold
                var rowClass = product.StockQuantity < product.LowStockThreshold ? "table-warning" : ""; // Add warning class

                <tr class="@rowClass">
                    <td>@product.ProductName</td>
                    <td>@product.Category?.CategoryName</td>
                    <td>@product.Supplier?.SupplierName</td>
                    <td>@product.Price</td>
                    <td>@product.StockQuantity
                    @if (product.StockQuantity < product.LowStockThreshold)
                    {
                        <span class="text-danger"> - Low Stock!</span>
                    }
                    </td>
                    <td>
                        @if (product.StockQuantity > 0)
                        {
                            <span class="badge bg-outline-success">In Stock</span> <!-- In Stock -->
                        }
                        else
                        {
                            <span class="badge bg-danger">Out of Stock</span> <!-- Out of Stock -->
                        }
                    </td>
                    <td>
                        <a class="btn btn-info btn-sm" asp-action="Details" asp-route-id="@product.ProductID">
                            <i class="fas fa-info-circle"></i> Details
                        </a>
                        <a class="btn btn-warning btn-sm" asp-action="Edit" asp-route-id="@product.ProductID">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a class="btn btn-danger btn-sm" asp-action="Delete" asp-route-id="@product.ProductID">
                            <i class="fas fa-trash-alt"></i> Delete
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
